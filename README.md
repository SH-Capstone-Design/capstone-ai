대화(커플 챗) 문장을 입력하면 8개 감정 라벨(기쁨/설렘/실망/후회/슬픔/짜증/불안/중립) 확률 분포를 예측하고, 1분 단위 타임라인/사용자별 집계를 제공합니다.
추론 품질 향상을 위해 간단 키워드 부스팅/부정어 감쇠/확률 샤프닝/중립 복귀 휴리스틱을 선택적으로 적용할 수 있습니다.

# ✨ 주요 기능

문맥 반영 추론(직전 N개 발화 + 현재 발화)

8라벨 확률 분포 + 최종 라벨/신뢰도

sent_at 기반 1분 단위 타임라인 집계

사용자 ID 중심 집계(role_binding으로 BF/GF → 실제 userId 매핑)

휴리스틱: 키워드 부스팅, 부정어 감쇠, 샤프닝, 중립 복귀 (ON/OFF 및 강도 조절 가능)

Pydantic(v1/v2) 호환, FastAPI 문서 자동화


# 🧩 모델/추론 로직 개요

inference.py

Hugging Face 포맷 모델 로드(ELECTRA 계열)

문맥 전처리: [CTX] <최근발화 ...> [BF|GF] <현재문장>

휴리스틱 파이프라인(기본 ON)

키워드 부스팅: 감정별 핵심 단어 매칭 시 확률 가산

부정어 감쇠: “아니/별로/안~/못~” 등 등장 시 긍정 계열 감쇠·부정 계열 미세 가산

샤프닝: 확률 분포를 γ-지수로 뾰족하게

중립 복귀: 최고 확률이 임계 미만이면 중립 가중

모든 단계 후 정규화로 합=1 보장

api.py

인증/검증/반올림(표시용)

sent_at 기반 타임라인 집계 및 userId별 집계

Pydantic 스키마 정의 및 응답 직렬화


# 🛠 트러블슈팅

401 Unauthorized: x-api-key 또는 .env의 API_KEY 확인

모델 로드 실패: FINETUNED_MODEL_PATH 또는 MODEL_DIR 경로/권한 확인

CUDA 관련 에러: GPU 미탑재 환경이면 자동으로 CPU로 전환됩니다

타임라인이 비어있음: 입력의 각 발화에 sent_at(ISO8601, timezone 포함) 필요
